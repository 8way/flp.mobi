#!/usr/bin/env ruby
$:.unshift(File.join File.dirname(__FILE__), '..')

require 'lib/opf'

def run cmd, vol
  IO.popen [cmd, vol].join(?\s) 
end

vol = ARGV.first; ARGV.shift
opf = OPF.new ARGV.first
opf.title = "The Feynman Lectures on Physics, Volume #{vol}"
run('./bin/chapters',vol).map(&:chomp).each {|filename| opf.add_chapter filename}
run('./bin/images',vol).map(&:chomp).each {|filename| opf.add_image filename}
File.write ARGV.first, opf.xml.to_xml

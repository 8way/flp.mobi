#!/usr/bin/env ruby

require 'nokogiri'

ARGV.each do |html|
  document = Nokogiri::HTML File.read(html)
  document.css('span.tag').each do |tag|
    # Insert a separating space after chapter/figure numbers.
    tag.content = tag.content << ?\s
  end
  document.xpath('//a[contains(@href,"#")]').each do |ref|
    # Remove page reference from internal links.
    href = ref.attribute('href')
    href.value = href.value.sub(/^.*#/,?#)
  end
  File.write(html, document.to_html)
end
